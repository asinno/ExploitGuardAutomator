function Test-ExploitGuardMitigation {
  param(
    [String]$ProcessPath
  )

  $ProcessList = Get-Process
  
  $Target = ($ProcessList | 
    Select * | 
  Where-Object -Property Path -eq $ProcessPath).ProcessName

  $Options =@('CFG','DEP','ForceRelocateImages','BottomUp','SEHOP','TerminateOnError','BlockDynamicCode','BlockLowLabelImageLoads','BlockRemoteImageLoads','DisableNonSystemFonts','MicrosoftSignedOnly','DisableExtensionPoints','DisableWin32kSystemCalls','DisallowChildProcessCreation','EnableExportAddressFilterPlus','EnableImportAddressFilter','EnableRopSimExec','EnableRopCallerCheck','StrictHandle','EnforceModuleDependencySigning','EnableRopStackPivot')
  
  foreach($Option in $Options){
    "[Option: $Option]"

    Set-Processmitigation "$ProcessPath" -Enable $Option
    
      "[Testing $Option]"
      $Process = Start-Process "$ProcessPath" -PassThru
      "[Enabled]"
      
      #$WaitCount = 0
      #while($Process.ExitCode -eq $null -and ($WaitCount -lt 3)){
      #  "[Waiting for exit code]"
      #  Start-Sleep 1
      #  $WaitCount++
      #}
      
      
      if ($Process.ExitCode -ne 0 -or ($Process.ExitCode -eq $Null)){
      "[Erroneous exit code]"
        Write-Warning "Process is not compatable with option $Option, automatically disabling"
        if($Option -ne $null){
          Set-Processmitigation "$ProcessPath" -Disable $Option
        }
      }
      Write-Host "[Terminating Process]"
      
      $StopProcess = Stop-Process -Name $Target -PassThru 
      '[Process Terminated]'
  }
  #Get-ProcessMitigation "C:\Program Files\OpenVPN Connect\OpenVPNConnect.exe"
}